#!/bin/bash

# Finance News Skill for OpenClaw
# Fetches latest finance/business news from Sina

get_stock_news() {
    local url="https://finance.sina.com.cn/stock/"
    local response=$(curl -s --connect-timeout 15 "$url" 2>/dev/null)
    
    if [[ -z "$response" ]]; then
        echo "âŒ æ— æ³•è·å–è´¢ç»æ–°é—»ï¼Œè¯·ç¨åé‡è¯•"
        return 1
    fi
    
    echo "## ğŸ“° è´¢ç»è¦é—»"
    echo ""
    
    echo "$response" | grep -oE 'title="[^"]+' 2>/dev/null | \
        sed 's/title="//g' | \
        sed 's/&amp;/\&/g' | \
        grep -E '.{10,50}' | \
        head -10
    
    echo ""
    echo "---"
    echo "*æ•°æ®æ¥æº: æ–°æµªè´¢ç»*"
}

get_market_news() {
    local url="https://finance.sina.com.cn/money/"
    local response=$(curl -s --connect-timeout 15 "$url" 2>/dev/null)
    
    if [[ -z "$response" ]]; then
        echo "âŒ æ— æ³•è·å–å¸‚åœºæ–°é—»ï¼Œè¯·ç¨åé‡è¯•"
        return 1
    fi
    
    echo "## ğŸ“ˆ å¸‚åœºæ–°é—»"
    echo ""
    
    echo "$response" | grep -oE 'title="[^"]+' 2>/dev/null | \
        sed 's/title="//g' | \
        sed 's/&amp;/\&/g' | \
        grep -E '.{10,50}' | \
        head -10
    
    echo ""
    echo "---"
    echo "*æ•°æ®æ¥æº: æ–°æµªè´¢ç»*"
}

get_macro_news() {
    local url="https://finance.sina.com.cn/macro/"
    local response=$(curl -s --connect-timeout 15 "$url" 2>/dev/null)
    
    if [[ -z "$response" ]]; then
        echo "âŒ æ— æ³•è·å–å®è§‚æ–°é—»ï¼Œè¯·ç¨åé‡è¯•"
        return 1
    fi
    
    echo "## ğŸ“Š å®è§‚è¦é—»"
    echo ""
    
    echo "$response" | grep -oE 'title="[^"]+' 2>/dev/null | \
        sed 's/title="//g' | \
        sed 's/&amp;/\&/g' | \
        grep -E '.{10,50}' | \
        head -10
    
    echo ""
    echo "---"
    echo "*æ•°æ®æ¥æº: æ–°æµªè´¢ç»*"
}

show_usage() {
    echo "## ğŸ“° è´¢ç»æ–°é—»"
    echo ""
    echo "å‘é€å…³é”®è¯è·å–æ–°é—»:"
    echo "- æ–°é—»: è´¢ç»è¦é—»"
    echo "- å¸‚åœº: å¸‚åœºæ–°é—»"
    echo "- å®è§‚: å®è§‚è¦é—»"
}

TYPE="$1"

case "$TYPE" in
    å¸‚åœº)
        get_market_news
        ;;
    å®è§‚)
        get_macro_news
        ;;
    ""|æ–°é—»|è´¢ç»)
        get_stock_news
        ;;
    *)
        get_stock_news
        ;;
esac
